schema: moran
source_dir: ..
script: |
  function eq(left, right)
    print('Left  = ' .. tostring(left))
    print('Right = ' .. tostring(right))
    return left == right
  end

deploy:
  default:
    tests:
      - send: l
        assert: eq(cand[1].text, 'äº†') and eq(cand[1].comment, "âš¡ï¸")
      - send: le
        assert: eq(cand[1].text, "æ¨‚") and eq(cand[1].comment, "âš¡ï¸")
      - send: lem
        assert: eq(cand[1].text, "æ¨‚") and eq(cand[1].comment, "âš¡ï¸")
      - send: lemd
        assert: eq(cand[1].text, "æ¥½") and eq(cand[1].comment, "")
      - send: hello
        assert: eq(cand[1].text, "hello")
      - send: jis
        assert: eq(cand[1].text, "ç´š") and eq(cand[1].comment, "âš¡ï¸")
      - send: jisjo
        assert: eq(cand[1].text, "ç´€")

  emoji:
    options:
      emoji: true
    tests:
      - send: hk
        assert: eq(cand[2].text, "ğŸ‘Œ")
      - send: o
        assert: eq(cand[2].text, "ğŸ˜¯")
      - send: ou
        assert: eq(cand[2].text, "â‚¬")
      - send: mzgo
        assert: eq(cand[2].text, "ğŸ‡ºğŸ‡¸")
      - send: vsgo
        assert: eq(cand[2].text, "ğŸ‡¨ğŸ‡³")
      - send: y
        assert: eq(cand[2].text, "1ï¸âƒ£")
      - send: 'e;'
        assert: eq(commit, 'å…’')
      - send: 'y;'
        assert: eq(commit, "åˆ")
      - send: 'sd;'
        assert: eq(commit, "3D")

  quick_code_indicator_empty:
    patch:
      moran/quick_code_indicator: ""
    tests:
      - send: l
        assert: eq(cand[1].text, "äº†") and eq(cand[1].comment, "")
  quick_code_indicator_other:
    patch:
      moran/quick_code_indicator: "ğŸ’¥"
    tests:
      - send: l
        assert: eq(cand[1].text, "äº†") and eq(cand[1].comment, "ğŸ’¥")
      - send: le
        assert: eq(cand[1].text, "æ¨‚") and eq(cand[1].comment, "ğŸ’¥")
      - send: lem
        assert: eq(cand[1].text, "æ¨‚") and eq(cand[1].comment, "ğŸ’¥")
      - send: lemd
        assert: eq(cand[1].text, "æ¥½") and eq(cand[1].comment, "")

  word_filter:
    patch:
      moran/enable_word_filter: true
    tests:
      - send: lmjx
        assert: eq(cand[1].text, "éˆæ¥")
      - send: lmjxz
        assert: eq(cand[1].text, "é€£æ¥")

  pin:
    options:
      emoji: false
    tests:
      - send: 'lmjx'
        assert: eq(cand[1].text, 'éˆæ¥') and eq(cand[2].text, 'é€£æ¥')
      - send: 'lmjx{Control+t}'
        assert: eq(cand[1].comment, "ğŸ“Œ")
      - send: 'lmjx{Control+t}'
        assert: eq(cand[1].comment, "")
      - send: 'lmjx{Down}{Control+t}'
        assert: eq(cand[1].text, 'é€£æ¥') and eq(cand[1].comment, "ğŸ“Œ")
      - send: 'lmjx'
        assert: eq(cand[1].text, 'é€£æ¥') and eq(cand[1].comment, "ğŸ“Œ")

  force_segmentation:
    tests:
      # input_len = 5
      - send: 'dafju'
        assert: eq(preedit, "da fju")
      - send: 'dafju{Control+l}'
        assert: eq(preedit, "daf'ju")
      - send: 'dafju{Control+l}{Control+l}'
        assert: eq(preedit, "da'fju")
      # input_len = 6
      - send: 'dajwhk'
        assert: eq(preedit, 'da jw hk')
      - send: 'dajwhk{Control+l}'
        assert: eq(preedit, "daj'whk")
      - send: 'dajwhk{Control+l}{Control+l}'
        assert: eq(preedit, "da'jw'hk")
      # input_len = 7
      - send: 'dajwhkn'
        assert: eq(preedit, 'da jw hkn')
      - send: 'dajwhkn{Control+l}'
        assert: eq(preedit, "da'jwh'kn")
      - send: 'dajwhkn{Control+l}{Control+l}'
        assert: eq(preedit, "daj'wh'kn")
      - send: 'dajwhkn{Control+l}{Control+l}{Control+l}'
        assert: eq(preedit, "da'jw'hkn")
